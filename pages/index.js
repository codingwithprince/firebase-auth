import Head from 'next/head'
import Image from 'next/image'
import styles from '../styles/Home.module.css'
import { initializeApp } from "firebase/app";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut } from "firebase/auth";
import { useState } from 'react';




export default function Home() {
  const [user, setUser] = useState({
    isLoggedIn: false,
    name:'',
    email:''
  })

  const firebaseConfig = {
    apiKey: "AIzaSyBErzJnwItXUZoXX_7HE9vI4RzjOZO0lFI",
    authDomain: "fir-auth-d106c.firebaseapp.com",
    projectId: "fir-auth-d106c",
    storageBucket: "fir-auth-d106c.appspot.com",
    messagingSenderId: "451585652973",
    appId: "1:451585652973:web:ea29440e5804ec0fb5f4e4"
  };
  
  const app = initializeApp(firebaseConfig);
  const provider = new GoogleAuthProvider();

  const handleSignIn = () =>{
    const auth = getAuth();

    signInWithPopup(auth, provider)
    .then((res) => {
    const {displayName, email} = res.user;
    const currentUser = {
      name: displayName,
      email: email,
      isLoggedIn: true
    }
    setUser(currentUser);
  })
  }
  const handleSignOut = () =>{
    const auth = getAuth();
    signOut(auth)
    .then(res => {
      const currentUser = {
        name: '',
        email: '',
        isLoggedIn: false
      }
      setUser(currentUser);
      
    }).catch((error) => {
      console.log(error)
    });
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        {user.isLoggedIn ? <div>
            <h2>Welcome Mr. {user.name}</h2>
            <h4>your email is {user.email}</h4>
            <button onClick={handleSignOut}>Sign Out</button>
          </div> :
          <div>
            <h1 className={styles.title}>
              Welcome to <a href="https://nextjs.org">Next.js!</a>
            </h1>
            <button onClick={handleSignIn}>Sign In</button>
          </div>
        }
        
        {/* <h1 className={styles.title}>
          Welcome to <a href="https://nextjs.org">Next.js!</a>
        </h1>
        <button onClick={handleSignIn}>Sign In</button>
        {
          user && <div>
            <h2>Welcome Mr. {user.name}</h2>
            <h4>your email is {user.email}</h4>
          </div>
        } */}
      </main>
    </div>
  )
}
